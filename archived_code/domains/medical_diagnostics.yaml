# ============================================================================
# DOMAIN CONFIGURATION: Medical Diagnostics Ontology
# ============================================================================
# Purpose: Standardize medical symptoms, conditions, and diagnostic relationships
# Use Case: Clinical decision support, symptom checker, medical knowledge graph
# WARNING: For educational/research purposes only. Not for clinical use.
# ============================================================================

metadata:
  name: "Medical Diagnostics & Symptoms Ontology"
  domain_id: "medical_diagnostics"
  version: "1.0.0"
  description: "Taxonomy of medical symptoms, conditions, and diagnostic relationships"
  owner: "Medical Informatics Research Team"
  created_at: "2025-10-25T00:00:00Z"
  updated_at: "2025-10-25T00:00:00Z"

node_types:
  - name: "symptom"
    display_name: "Medical Symptom"
    description: "A subjective indication of disease or health condition (e.g., fever, fatigue)"
    schema:
      - property_name: "severity_scale"
        property_type: "string"
        required: false
        default: "mild|moderate|severe"
      - property_name: "body_system"
        property_type: "string"
        required: false

  - name: "condition"
    display_name: "Medical Condition"
    description: "A disease, disorder, or health state (e.g., diabetes, influenza)"
    schema:
      - property_name: "icd10_code"
        property_type: "string"
        required: false
      - property_name: "prevalence"
        property_type: "string"
        required: false

  - name: "diagnostic_test"
    display_name: "Diagnostic Test"
    description: "A medical test or procedure (e.g., blood test, X-ray, MRI)"
    schema:
      - property_name: "test_type"
        property_type: "string"
        required: false
      - property_name: "invasiveness"
        property_type: "string"
        required: false

  - name: "body_part"
    display_name: "Anatomical Body Part"
    description: "A specific body structure or organ (e.g., liver, lung, knee)"
    schema:
      - property_name: "body_system"
        property_type: "string"
        required: false

relationship_types:
  - name: "symptom_of"
    display_name: "Symptom Of"
    description: "Symptom is characteristic of a medical condition"
    source_types: ["symptom"]
    target_types: ["condition"]
    properties:
      - property_name: "frequency_percentage"
        property_type: "float"
        required: false
        default: null
      - property_name: "specificity"
        property_type: "string"
        required: false
    cardinality: "many_to_many"

  - name: "diagnosed_by"
    display_name: "Diagnosed By"
    description: "Condition can be diagnosed using this test"
    source_types: ["condition"]
    target_types: ["diagnostic_test"]
    properties:
      - property_name: "sensitivity"
        property_type: "float"
        required: false
      - property_name: "specificity"
        property_type: "float"
        required: false
    cardinality: "many_to_many"

  - name: "affects_body_part"
    display_name: "Affects Body Part"
    description: "Condition or symptom affects a specific body part"
    source_types: ["condition", "symptom"]
    target_types: ["body_part"]
    properties: []
    cardinality: "many_to_many"

  - name: "is_subtype_of"
    display_name: "Is Subtype Of"
    description: "Hierarchical classification (e.g., Type 2 Diabetes is_subtype_of Diabetes)"
    source_types: ["condition", "symptom"]
    target_types: ["condition", "symptom"]
    properties: []
    cardinality: "many_to_one"

  - name: "comorbid_with"
    display_name: "Comorbid With"
    description: "Conditions frequently occurring together"
    source_types: ["condition"]
    target_types: ["condition"]
    properties:
      - property_name: "correlation_strength"
        property_type: "float"
        required: false
    cardinality: "many_to_many"

data_sources:
  - name: "patient_symptoms_database"
    type: "csv"
    enabled: true
    path: "data/patient_symptoms.csv"
    encoding: "utf-8"
    delimiter: ","
    mappings:
      - source_column: "reported_symptom"
        target_node_type: "symptom"
        action: "analyze_and_map"
        transform: "value.lower().strip()"

  - name: "medical_literature_api"
    type: "api"
    enabled: false
    url: "https://api.pubmed.gov/conditions"
    method: "GET"
    headers:
      Accept: "application/json"
    auth_type: "none"
    mappings:
      - source_column: "condition_name"
        target_node_type: "condition"
        action: "analyze_and_map"

llm:
  enabled: true
  provider: "openai"
  model: "gpt-4o-mini"
  api_key_env: "OPENAI_API_KEY"
  temperature: 0.0
  max_tokens: 600

  prompts:
    densification: |
      You are a medical informatics expert specializing in symptom and condition taxonomy.

      IMPORTANT: This is for research/educational purposes only, not clinical diagnosis.

      Raw symptom/condition to analyze: "{{ node_name }}"
      Domain: {{ metadata.name }}

      Available node types:
      {% for node_type in node_types %}
      - {{ node_type.name }}: {{ node_type.description }}
      {% endfor %}

      Available relationship types:
      {% for rel_type in relationship_types %}
      - {{ rel_type.name }}: {{ rel_type.description }}
      {% endfor %}

      Existing canonical nodes (sample):
      {{ existing_nodes_sample | join(', ') }}

      Respond ONLY with valid JSON:
      {
        "canonical_name": "normalized_medical_term",
        "node_type": "symptom | condition | diagnostic_test | body_part",
        "aliases": ["original_term", "medical_synonym", "lay_term"],
        "relationships": [
          {
            "type": "symptom_of | is_subtype_of | affects_body_part",
            "target": "target_canonical_name",
            "properties": {}
          }
        ],
        "properties": {
          "icd10_code": "A00.0",
          "body_system": "respiratory"
        }
      }

      Rules:
      1. Use standard medical terminology for canonical_name (snake_case)
      2. Include both medical and lay terms in aliases
      3. Specify body_system when applicable (respiratory, cardiovascular, neurological, etc.)
      4. Create hierarchical relationships using is_subtype_of
      5. Link symptoms to conditions using symptom_of
      6. For conditions, include ICD-10 code if known

      Examples:
      - "headache" → {"canonical_name": "cephalgia", "node_type": "symptom", "aliases": ["headache", "cephalgia", "head pain"], "relationships": [{"type": "symptom_of", "target": "migraine"}], "properties": {"body_system": "neurological"}}
      - "diabetes type 2" → {"canonical_name": "diabetes_mellitus_type_2", "node_type": "condition", "aliases": ["type 2 diabetes", "diabetes mellitus type 2", "t2dm"], "relationships": [{"type": "is_subtype_of", "target": "diabetes_mellitus"}], "properties": {"icd10_code": "E11"}}

    suggestion: |
      Given the unknown medical term "{{ node_name }}",
      suggest the top {{ top_k }} most similar canonical terms.

      Available canonical terms:
      {{ canonical_nodes_sample | join(', ') }}

      Return ONLY a JSON array:
      ["canonical_term_1", "canonical_term_2", "canonical_term_3"]

validation:
  auto_approve_threshold: 100
  min_alias_length: 3
  max_alias_length: 150
  allow_duplicates: false
  require_relationships: false

export:
  formats:
    - type: "cypher"
      enabled: true
    - type: "json"
      enabled: true
      options:
        indent: 2

  neo4j:
    enabled: true
    node_label_mapping:
      symptom: "Symptom"
      condition: "Condition"
      diagnostic_test: "DiagnosticTest"
      body_part: "BodyPart"
    relationship_label_mapping:
      symptom_of: "SYMPTOM_OF"
      diagnosed_by: "DIAGNOSED_BY"
      affects_body_part: "AFFECTS"
      is_subtype_of: "IS_SUBTYPE_OF"
      comorbid_with: "COMORBID_WITH"

cache:
  enabled: true
  ttl_seconds: 3600
  max_size: 50000

webhooks:
  on_node_created: []
  on_relationship_created: []
  on_enrichment_completed: []

extensions:
  custom_processors:
    - module: "extensions.medical_validators"
      function: "validate_icd10_code"
      event: "pre_process"
  ui_customization:
    primary_color: "#EF4444"
    logo_url: ""
    custom_css: ""

migration:
  legacy_mappings: []
  deprecated_types: []
